generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                           Int                           @id @default(autoincrement())
  name                         String
  username                     String                        @unique
  email                        String                        @unique
  bio                          String?
  location                     String?
  interests                    String[]                      @default([])
  password                     String
  avatar                       String?
  hasCompletedOnboarding       Boolean                       @default(false)
  themeId                      Int?
  customThemeSettings          Json?
  points                       Int                           @default(0)
  totalPointsEarned            Int                           @default(0)
  loginStreak                  Int                           @default(0)
  lastLoginAt                  DateTime?
  createdAt                    DateTime                      @default(now())
  profileVideoUrl              String?
  profileVideoThumbnailUrl     String?
  useVideoAvatar               Boolean                       @default(false)
  coverImageUrl                String?
  coverVideoUrl                String?
  ambiguousReferencesAuthored  AmbiguousReference[]          @relation("AmbiguousReferenceAuthor")
  ambiguousReferenceCandidates AmbiguousReferenceCandidate[] @relation("AmbiguousReferenceTarget")
  comments                     Comment[]
  commentReactions             CommentReaction[]
  conversations                ConversationParticipant[]
  feedbackAuthored             Feedback[]
  feedbackVotes                FeedbackVote[]
  receivedFriendships          Friendship[]                  @relation("friendAddressee")
  requestedFriendships         Friendship[]                  @relation("friendRequester")
  likes                        Like[]
  messages                     Message[]
  notifications                Notification[]
  posts                        Post[]
  projects                     Project[]
  reactions                    Reaction[]
  reelReactions                ReelReaction[]
  squadMemberships             SquadMember[]
  theme                        Theme?                        @relation(fields: [themeId], references: [id])
  userBadges                   UserBadge[]
  interactions                 UserInteraction[]
  userItems                    UserItem[]
  preferences                  UserPreference?
  relationsAsUser1             UserRelation[]                @relation("UserRelationUser1")
  relationsAsUser2             UserRelation[]                @relation("UserRelationUser2")
  termStats                    UserTermStats[]
  reels                        Reel[]
}

model Post {
  id                  Int                  @id @default(autoincrement())
  content             String
  image               String?
  createdAt           DateTime             @default(now())
  authorId            Int
  tags                String[]             @default([])
  hashtags            String[]             @default([])
  type                PostType             @default(NORMAL)
  squadId             Int?
  projectId           Int?
  ambiguousReferences AmbiguousReference[] @relation("PostAmbiguousReferences")
  comments            Comment[]
  likes               Like[]
  author              User                 @relation(fields: [authorId], references: [id])
  project             Project?             @relation(fields: [projectId], references: [id])
  squad               Squad?               @relation(fields: [squadId], references: [id])
  reactions           Reaction[]
}

model Comment {
  id        Int               @id @default(autoincrement())
  content   String
  createdAt DateTime          @default(now())
  authorId  Int
  postId    Int
  author    User              @relation(fields: [authorId], references: [id])
  post      Post              @relation(fields: [postId], references: [id])
  reactions CommentReaction[]
}

model Like {
  id        Int      @id @default(autoincrement())
  createdAt DateTime @default(now())
  userId    Int
  postId    Int
  post      Post     @relation(fields: [postId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@unique([userId, postId])
}

model Reaction {
  id        Int          @id @default(autoincrement())
  type      ReactionType
  createdAt DateTime     @default(now())
  userId    Int
  postId    Int
  post      Post         @relation(fields: [postId], references: [id])
  user      User         @relation(fields: [userId], references: [id])

  @@unique([userId, postId])
}

model CommentReaction {
  id        Int          @id @default(autoincrement())
  type      ReactionType
  createdAt DateTime     @default(now())
  userId    Int
  commentId Int
  comment   Comment      @relation(fields: [commentId], references: [id])
  user      User         @relation(fields: [userId], references: [id])

  @@unique([userId, commentId])
}

model Reel {
  id              Int           @id @default(autoincrement())
  url             String        // URL of the video content
  thumbnailUrl    String?       // URL of the video thumbnail
  title           String?
  authorId        Int
  createdAt       DateTime      @default(now())
  views           Int           @default(0) // Optional: to track views
  author          User          @relation(fields: [authorId], references: [id])
  reactions       ReelReaction[]
  // Add other fields as needed, e.g., description, tags, etc.
}

model ReelReaction {
  id        Int          @id @default(autoincrement())
  type      ReactionType
  createdAt DateTime     @default(now())
  userId    Int
  reelId    Int
  reel      Reel         @relation(fields: [reelId], references: [id])
  user      User         @relation(fields: [userId], references: [id])

  @@unique([userId, reelId])
}

model Friendship {
  id               Int              @id @default(autoincrement())
  requesterId      Int
  addresseeId      Int
  status           FriendshipStatus @default(PENDING)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  relationCategory String?
  relationDetail   String?
  addressee        User             @relation("friendAddressee", fields: [addresseeId], references: [id])
  requester        User             @relation("friendRequester", fields: [requesterId], references: [id])

  @@unique([requesterId, addresseeId])
}

model Notification {
  id        Int              @id @default(autoincrement())
  type      NotificationType
  data      Json
  readAt    DateTime?
  createdAt DateTime         @default(now())
  userId    Int
  user      User             @relation(fields: [userId], references: [id])
}

model UserPreference {
  id        Int      @id @default(autoincrement())
  userId    Int      @unique
  cardStyle Json?
  theme     String?
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
}

model UserInteraction {
  id        Int             @id @default(autoincrement())
  userId    Int
  type      InteractionType
  weight    Int
  createdAt DateTime        @default(now())
  user      User            @relation(fields: [userId], references: [id])
}

model Theme {
  id                 Int        @id @default(autoincrement())
  key                String     @unique
  name               String
  primaryColor       String?
  secondaryColor     String?
  backgroundGradient String?
  decorations        Json?
  createdAt          DateTime   @default(now())
  shopItems          ShopItem[]
  users              User[]
}

model ShopItem {
  id          Int              @id @default(autoincrement())
  key         String           @unique
  name        String
  description String?
  category    ShopItemCategory
  pricePoints Int
  assetData   Json?
  themeKey    String?
  theme       Theme?           @relation(fields: [themeKey], references: [key])
  userItems   UserItem[]
}

model UserItem {
  id         Int      @id @default(autoincrement())
  userId     Int
  itemId     Int
  acquiredAt DateTime @default(now())
  equipped   Boolean  @default(false)
  item       ShopItem @relation(fields: [itemId], references: [id])
  user       User     @relation(fields: [userId], references: [id])
}

model Squad {
  id          Int           @id @default(autoincrement())
  name        String
  slug        String        @unique
  description String
  tags        String[]      @default([])
  type        SquadType     @default(GENERAL)
  createdAt   DateTime      @default(now())
  posts       Post[]
  members     SquadMember[]
}

model SquadMember {
  userId   Int
  squadId  Int
  role     SquadRole @default(MEMBER)
  joinedAt DateTime  @default(now())
  squad    Squad     @relation(fields: [squadId], references: [id])
  user     User      @relation(fields: [userId], references: [id])

  @@id([userId, squadId])
}

model Project {
  id          Int               @id @default(autoincrement())
  userId      Int
  title       String
  description String?
  category    ProjectCategory   @default(OTRO)
  targetDate  DateTime?
  visibility  ProjectVisibility @default(PUBLIC)
  needsHelp   Boolean           @default(false)
  progress    Int               @default(0)
  posts       Post[]
  user        User              @relation(fields: [userId], references: [id])
}

model Badge {
  id          Int         @id @default(autoincrement())
  code        String      @unique
  name        String
  description String?
  icon        String?
  createdAt   DateTime    @default(now())
  userBadges  UserBadge[]
}

model UserBadge {
  userId    Int
  badgeId   Int
  grantedAt DateTime @default(now())
  badge     Badge    @relation(fields: [badgeId], references: [id])
  user      User     @relation(fields: [userId], references: [id])

  @@id([userId, badgeId])
}

model Feedback {
  id            Int            @id @default(autoincrement())
  authorId      Int
  title         String
  description   String
  votes         Int            @default(0)
  status        FeedbackStatus @default(NEW)
  createdAt     DateTime       @default(now())
  author        User           @relation(fields: [authorId], references: [id])
  feedbackVotes FeedbackVote[]
}

model FeedbackVote {
  userId     Int
  feedbackId Int
  createdAt  DateTime @default(now())
  feedback   Feedback @relation(fields: [feedbackId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@id([userId, feedbackId])
}

model Hashtag {
  id         Int      @id @default(autoincrement())
  canonical  String   @unique
  display    String
  useCount   Int      @default(0)
  lastUsedAt DateTime @default(now())
}

model TermGlobal {
  id          Int      @id @default(autoincrement())
  term        String
  normalized  String   @unique
  totalCount  Int      @default(0)
  firstSeenAt DateTime @default(now())
  lastSeenAt  DateTime @default(now())
}

model TermTopicStats {
  id             Int    @id @default(autoincrement())
  termNormalized String
  tag            String
  count          Int    @default(0)

  @@unique([termNormalized, tag])
}

model UserTermStats {
  id           Int      @id @default(autoincrement())
  userId       Int
  term         String
  normalized   String
  isProperName Boolean  @default(false)
  count        Int      @default(0)
  lastSeenAt   DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id])

  @@unique([userId, normalized])
  @@index([userId, normalized])
}

model UserRelation {
  id                Int      @id @default(autoincrement())
  user1Id           Int
  user2Id           Int
  score             Float    @default(0)
  lastInteractionAt DateTime @default(now())
  user1             User     @relation("UserRelationUser1", fields: [user1Id], references: [id])
  user2             User     @relation("UserRelationUser2", fields: [user2Id], references: [id])

  @@unique([user1Id, user2Id])
}

model AmbiguousReference {
  id         Int                           @id @default(autoincrement())
  postId     Int
  authorId   Int
  label      String
  sentiment  String
  kind       String
  createdAt  DateTime                      @default(now())
  author     User                          @relation("AmbiguousReferenceAuthor", fields: [authorId], references: [id])
  post       Post                          @relation("PostAmbiguousReferences", fields: [postId], references: [id])
  candidates AmbiguousReferenceCandidate[]
}

model AmbiguousReferenceCandidate {
  id           Int                @id @default(autoincrement())
  referenceId  Int
  targetUserId Int
  confidence   Float              @default(0)
  reference    AmbiguousReference @relation(fields: [referenceId], references: [id])
  target       User               @relation("AmbiguousReferenceTarget", fields: [targetUserId], references: [id])
}

model Conversation {
  id           Int                       @id @default(autoincrement())
  isDirect     Boolean                   @default(true)
  createdAt    DateTime                  @default(now())
  participants ConversationParticipant[]
  messages     Message[]
}

model ConversationParticipant {
  id             Int          @id @default(autoincrement())
  conversationId Int
  userId         Int
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  user           User         @relation(fields: [userId], references: [id])

  @@unique([conversationId, userId])
}

model Message {
  id             Int          @id @default(autoincrement())
  content        String
  createdAt      DateTime     @default(now())
  senderId       Int
  conversationId Int
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  sender         User         @relation(fields: [senderId], references: [id])
}

enum ReactionType {
  MACANUDO
  MESSIRVE
  JAJAJA
  DE_UNA
  QUE_BOLUDO
  QUE_BAJON
}

enum PostType {
  NORMAL
  HELP_REQUEST
  PROJECT_UPDATE
}

enum FriendshipStatus {
  PENDING
  ACCEPTED
}

enum NotificationType {
  REACTION
  MENTION
  MESSAGE
  REEL_SHARED
}

enum InteractionType {
  REGISTER
  LOGIN
  POST_CREATED
  COMMENT_CREATED
  LIKE_GIVEN
}

enum ShopItemCategory {
  THEME
  DECORATION
}

enum SquadType {
  FOTO
  FITNESS
  IDIOMAS
  GENERAL
}

enum SquadRole {
  MEMBER
  ADMIN
}

enum ProjectCategory {
  PERSONAL
  CREATIVO
  SALUD
  ESTUDIO
  OTRO
}

enum ProjectVisibility {
  PUBLIC
  FRIENDS
  PRIVATE
}

enum FeedbackStatus {
  NEW
  REVIEWING
  IN_PROGRESS
  DONE
}
